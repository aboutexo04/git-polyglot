name: Test Translation Action

on:
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    
    # ğŸ”‘ [í•„ìˆ˜] 403 ì—ëŸ¬ í•´ê²°ì„ ìœ„í•œ ì¶œì…ì¦ ë°œê¸‰
    permissions:
      contents: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Run GitPolyglot
        uses: ./ 
        with:
          openrouter_api_key: ${{ secrets.OPENROUTER_API_KEY }}
          target_languages: 'ko'
          source_file: 'README.md'
          # ğŸ‘‡ [ë³€ê²½] Meta Llama 3.3 70B (ë‹¤êµ­ì–´ ì§€ì› ìš°ìˆ˜)
          model_name: 'meta-llama/llama-3.3-70b-instruct:free' 

      - name: Commit and Push changes
        run: |
          git config --global user.name "GitPolyglot Bot"
          git config --global user.email "bot@gitpolyglot.com"
          
          # íŒŒì¼ ëª©ë¡ í™•ì¸
          ls -al 
          
          # ë²ˆì—­ëœ íŒŒì¼ ì¶”ê°€
          git add README.ko.md
          
          # ì»¤ë°‹ & í‘¸ì‹œ
          git commit -m "Auto-translated README by Qwen" || echo "No changes to commit"
          git push
      - name: Run GitPolyglot
        # íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì§ì ‘ ì‹¤í–‰í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë³€ê²½ (ê°€ì¥ í™•ì‹¤í•¨)
        env:
          OPENROUTER_API_KEY: ${{ secrets.OPENROUTER_API_KEY }}
          MODEL_NAME: 'qwen/qwen-2-7b-instruct:free'
        run: |
          pip install -r requirements.txt
          python main.py README.md

      - name: Commit and Push changes
        run: |
          git config --global user.name "GitPolyglot Bot"
          git config --global user.email "bot@gitpolyglot.com"
          
          # ë§Œë“¤ì–´ì§„ ëª¨ë“  ë²ˆì—­ íŒŒì¼ ì¶”ê°€ (*.ko.md, *.ja.md, *.zh.md)
          git add README.*.md
          
          git commit -m "Auto-translated README (KO, JA, ZH)" || echo "No changes"
          git push
